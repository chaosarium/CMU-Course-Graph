<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="node_id" content="null">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Testing</title>

  <script src="static/obsidian_core.js"></script>
  <link rel="stylesheet" href="static/master.css" />

</head>
<body>

  <div id="page_holder">

    <div>

      <!-- dummy button -->
      <button class="graph_button graph_show_button" id="Bgraph_full_page" level="" note_temp_id="graph_full_page"
        style="visibility: hidden; margin:0px">
        Show Graph
      </button>

      <!-- 2d 3d toggle button -->
      <button class="graph_button graph_type_button" id="Cgraph_full_page"
        style="flex:1; margin:0px; margin-right:0.2rem;" onclick="window.graphModule.switch_graph_type(this);">
        2D
      </button>

    </div>
    
    <div id="Agraph_full_page" class="graph_div_full"></div>

  </div>

  <script type="module">
    // load full graph when ready
    document.addEventListener('DOMContentLoaded', load_fullpage_graph);

    function load_fullpage_graph() {

      // set graph_type button correctly
      let type_d = ls_get('graph_type_d');
      if (!type_d) {
        ls_set('graph_type_d', '2D');
        type_d = '2D';
      }
      // change text on graph type selection button
      document.getElementById('Cgraph_full_page').innerHTML = type_d;

      import('/static/graph.js').then((Module) => {
        window.graphModule = Module;



        // initialise graph
        window.graphModule.arm_page(document.getElementById('page_holder'))



        // overwrites clicking actions
        window.graphModule.default_actions['open_link'] = function (args) {
          console.log('hi openlink')
          return window.graphModule.graph_open_link_normal(args)()
        }
        window.graphModule.default_actions['left_click'] = function (args) {
          console.log('hi leftclick')
          let g = window.graphModule.graphs[args.uid];
          return g.actions['select_node'](args);
        }
        window.graphModule.default_actions['right_click'] = function (args) {
          console.log('hi rightclick')
          let g = window.graphModule.graphs[args.uid];
          return g.actions['open_link'](args);
        }



        // Get node id from the page where we clicked on the icon for the fullpage graph
        const urlParams = new URLSearchParams(window.location.search);
        const pinnedNode = urlParams.get('node');



        // Immediately run graph instead of waiting for button click
        window.graphModule.run(document.getElementById('Bgraph_full_page'), 'graph_full_page', pinnedNode);
      })
    }
  </script>

</body>
</html>